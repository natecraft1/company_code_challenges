<!doctype html>
<html lang="en" ng-app>
<head>
	<meta charset="UTF-8">
	<title>Document</title>
	<script src="https://cdn.jsdelivr.net/snap.svg/0.2.0/snap.svg-min.js"></script>
	<link rel="stylesheet" href="style.css">
</head>
<body>
	<button id="one">B1</button>
	<button id="two">B2</button>
	<div id="bucket1">
		
	</div>
<script>
	var width = 800; 
	var s = Snap(width,600);
	var aspect_ratio = 822/567;
	var lake = s.image("imgs/lake-figure-color.svg", 0, -100, width, width/aspect_ratio);
	// I couldn't find out how to obtain this dynamically because lake.attr("width") didnt work, 
	// and there is no callback for Snap.image 

	// lake.attr("width") wasn't working so...
	var current_scale = 1;
	var current_width = 800;
	var current_height = current_width/aspect_ratio;
	var scale_factor = current_scale * 1.2;
	var translateX = -(scale_factor*current_width-current_width)/2;
	var translateY = -(scale_factor*current_height-current_height)/2;
	var m = new Snap.Matrix();
	m.scale(scale_factor, scale_factor, 0, -100);
	console.log(translateX, translateY)
	m.translate(translateX, translateY);

	lake.animate({ "transform": m }, 2000, function() {
		m.scale(current_scale/scale_factor, current_scale/scale_factor, 0, -100);
		m.translate(-translateX, -translateY);
		lake.animate({ "transform": m }, 2000);
	});

 	var step = {
		"count": 0,
		"check": function() {
			return buckets.one.height == buckets.gallons || buckets.two.height == buckets.gallons;
		}
	}
	var buckets = {"one": {"height": 0 }, "two": {"height": 0}};
	water(5, 11, 4);
	function water(x,y,z) {
		buckets.one.size = x;
		buckets.two.size = y;
		buckets.gallons = z;
		while (!step.check() && step.count < 100) {
			if (buckets.two.height == 0) {
				fill(buckets.two);
			} else if (buckets.two.height == buckets.two.size
				|| buckets.one.height == 0) {
				transfer(buckets.two, buckets.one);
			} else if (buckets.one.height == buckets.one.size) {
				empty(buckets.one);
			}
			step.count += 1;
		}
	}
	function fill(bucket) {
		bucket.height = bucket.size;
	}
	function transfer(from, to) {
		var alotted = to.size - to.height;
		var desired = from.height;
		var actual_amount = desired > alotted ? alotted : desired;
		from.height -= actual_amount;
		to.height += actual_amount;
	}
	function empty(bucket) {
		bucket.height = 0;
	}
</script>
</body>
</html>